
# AnkleSolver README

## 1. 项目概述
- AnkleSolver 是一个用于求解机器人平行四边形踝关节结构，运动学和动力学的 C++ 类库。它提供了踝关节的逆运动学、正运动学、雅可比矩阵计算、正动力学和逆动力学等功能。所有参数通过 JSON 配置文件加载，便于修改和扩展。
- 现已经在多款人形机器人验证过了，只要够型相同就没问题

## 2. 功能说明

### 2.1 主要功能
- **逆运动学**：根据给定的姿态角（俯仰角和滚转角）计算电机角度。
- **正运动学**：根据电机角度计算踝关节的姿态角。
- **雅可比矩阵计算**：生成踝关节的雅可比矩阵，用于运动学和动力学分析。
- **正动力学**：根据电机扭矩计算踝关节的扭矩。
- **逆动力学**：根据踝关节所需的扭矩计算电机扭矩。

### 2.2 关节类型
- **左踝关节（LeftAnkle）**：值为 0。
- **右踝关节（RightAnkle）**：值为 1。
- **注**：默认左右脚是对称的。

### 2.3 坐标和角度约定
- **视角**：左/右视角均为从机器人后侧向前看的视角，即把自己当成机器人。
- **电机角度**：在水平面时为 0 度，向上为正，向下为负。速度和力矩的正负方向与角度一致。

## 3. 配置文件说明

### 3.1 JSON 配置文件参数说明
- **l_bar**：电机输出到球铰的距离（单位：mm）。
- **l_shortRod**：较短连杆的长度（单位：mm）。
- **l_longRod**：较长连杆的长度（单位：mm）。
- **l_spacing**：y 轴方向的距离（目前未使用）。
- **crdA1, crdB1, crdC1**：踝关节左侧的 A、B、C 点坐标。
- **crdA2, crdB2, crdC2**：踝关节右侧的 A、B、C 点坐标。
  - **关于ABC坐标**：
    - 必须使用左腿进行测量！！所有解算均基于左腿。
    - 在初始状态（小腿与脚垂直情况下），以十字轴中点 O 作为坐标系原点，右手坐标系，前向为 x 轴。
    - 坐标 C 为脚上球铰（即连杆下侧）的坐标，B 为电机输出端球铰（即连杆上侧）的坐标，A 为电机输出面圆心的坐标。
    - 具体数值可以在 Solidworks 中测得，重要的是 x 和 z 分量，y 分量与 C 点的相同即可。
- **newtonEulerTolerance**：牛顿-欧拉迭代的精度。
- **maxIter**：最大迭代次数。

## 4. 注意事项

### 4.1 JSON 文件路径
确保 JSON 配置文件路径正确。如果路径错误，程序将抛出运行时错误。

### 4.2 Eigen 库路径
AnkleSolver 使用 Eigen 库进行矩阵运算。确保在编译时正确链接 Eigen 库。如果使用系统安装的 Eigen，确保其路径正确。

### 4.3 动力学计算
动力学计算依赖于电机扭矩和当前姿态角，注意不是期望值，否则雅可比矩阵会出错。确保输入的电机扭矩和姿态角单位一致。

## 5. 编译和运行
确保安装了 Eigen3 库（可通过以下命令安装）：
```bash
sudo apt install libeigen3-dev
```
使用 CMake 编译项目：
```bash
mkdir build
cd build
cmake ..
make
./main
```
## 6. 联系方式
定制sdk请联系：Saki8421@outlook.com
